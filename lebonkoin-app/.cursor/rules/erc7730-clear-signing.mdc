# ðŸ” ERC-7730 CLEAR SIGNING - LEBONKOIN

## ðŸŽ¯ OBJECTIF CLEAR SIGNING
Transformer toutes les transactions LeBonKoin en signatures **lisibles et comprÃ©hensibles** pour l'utilisateur final, Ã©liminant le "blind signing" dangereux.

## ðŸ“‹ RÃˆGLES OBLIGATOIRES ERC-7730

### âœ… Toujours ImplÃ©menter
```typescript
// OBLIGATOIRE : Chaque interaction smart contract doit avoir son descripteur ERC-7730
// RÃ©fÃ©rence : https://developers.ledger.com/docs/clear-signing/understanding/what-is-it

// Format standard ERC-7730
interface ERC7730Descriptor {
  schemaVersion: "1.0.0";
  metadata: {
    name: string;           // Nom clair de l'action
    description: string;    // Description dÃ©taillÃ©e
    shortName?: string;     // Nom court pour petits Ã©crans
  };
  display: {
    formats: DisplayFormat[];
  };
}
```

### ðŸ›’ Descripteurs LeBonKoin SpÃ©cifiques

#### 1. Paiement d'Achat
```json
{
  "schemaVersion": "1.0.0",
  "metadata": {
    "name": "LeBonKoin - Paiement SÃ©curisÃ©",
    "description": "Paiement pour achat d'objet avec dÃ©pÃ´t de garantie",
    "shortName": "Payer Article"
  },
  "display": {
    "formats": [{
      "intent": "Payer {{amount}} USDC pour {{itemName}}",
      "fields": {
        "amount": {
          "label": "Montant",
          "format": "amount",
          "params": {
            "tokenAddress": "0x...",
            "threshold": "1000000"
          }
        },
        "itemName": {
          "label": "Article",
          "format": "string"
        },
        "sellerId": {
          "label": "Vendeur",
          "format": "addressName"
        }
      }
    }]
  }
}
```

#### 2. LibÃ©ration de Fonds
```json
{
  "schemaVersion": "1.0.0",
  "metadata": {
    "name": "LeBonKoin - Confirmation RÃ©ception",
    "description": "Confirmer la rÃ©ception de l'objet et libÃ©rer les fonds",
    "shortName": "Confirmer RÃ©ception"
  },
  "display": {
    "formats": [{
      "intent": "Confirmer rÃ©ception et libÃ©rer {{amount}} USDC vers {{seller}}",
      "fields": {
        "amount": {
          "label": "Montant Ã  libÃ©rer",
          "format": "amount"
        },
        "seller": {
          "label": "Vendeur",
          "format": "addressName"
        }
      }
    }]
  }
}
```

#### 3. CrÃ©ation d'Annonce
```json
{
  "schemaVersion": "1.0.0",
  "metadata": {
    "name": "LeBonKoin - CrÃ©ation Annonce",
    "description": "CrÃ©er une nouvelle annonce de vente",
    "shortName": "CrÃ©er Annonce"
  },
  "display": {
    "formats": [{
      "intent": "CrÃ©er annonce '{{title}}' au prix de {{price}} USDC",
      "fields": {
        "title": {
          "label": "Titre",
          "format": "string"
        },
        "price": {
          "label": "Prix",
          "format": "amount"
        }
      }
    }]
  }
}
```

## ðŸ”§ IMPLÃ‰MENTATION TECHNIQUE

### Structure des Fichiers
```
/src/contracts/ERC7730Descriptors/
  â”œâ”€â”€ payment.json           # Descripteur paiement
  â”œâ”€â”€ release.json          # Descripteur libÃ©ration
  â”œâ”€â”€ listing.json          # Descripteur crÃ©ation annonce
  â”œâ”€â”€ refund.json           # Descripteur remboursement
  â””â”€â”€ dispute.json          # Descripteur rÃ©solution litige
```

### Validation avec Ledger Builder
```typescript
// OBLIGATOIRE : Utiliser le builder Ledger pour valider
// URL : https://get-clear-signed.ledger.com/

// Ã‰tapes obligatoires :
// 1. Copier l'adresse du contrat LeBonKoin
// 2. Coller l'ABI du contrat
// 3. GÃ©nÃ©rer les descripteurs JSON
// 4. Tester avec des transactions rÃ©elles
// 5. Valider l'affichage sur Ledger
```

### IntÃ©gration Smart Contract
```solidity
// Dans LeBonKoinEscrow.sol
pragma solidity ^0.8.0;

contract LeBonKoinEscrow {
    // OBLIGATOIRE : Toutes les fonctions publiques doivent avoir un descripteur ERC-7730
    
    function createEscrow(
        uint256 listingId,
        address seller,
        uint256 amount,
        string calldata itemName
    ) external {
        // Logique escrow...
        // Le descripteur ERC-7730 affichera :
        // "Payer {amount} USDC pour {itemName}"
    }
    
    function releaseFunds(uint256 escrowId) external {
        // Logique libÃ©ration...
        // Le descripteur ERC-7730 affichera :
        // "Confirmer rÃ©ception et libÃ©rer {amount} USDC vers {seller}"
    }
}
```

### IntÃ©gration Frontend
```typescript
// Dans le composant de paiement
import { useERC7730 } from '@/hooks/useERC7730';

const PaymentComponent = () => {
  const { validateTransaction } = useERC7730();
  
  const handlePayment = async () => {
    // OBLIGATOIRE : Valider que la transaction sera claire
    const isValidERC7730 = await validateTransaction({
      contractAddress: ESCROW_CONTRACT_ADDRESS,
      functionName: 'createEscrow',
      params: [listingId, seller, amount, itemName]
    });
    
    if (!isValidERC7730) {
      throw new Error('Transaction non compatible ERC-7730');
    }
    
    // ProcÃ©der au paiement...
  };
};
```

## ðŸš¨ RÃˆGLES DE SÃ‰CURITÃ‰

### Validation Obligatoire
```typescript
// TOUJOURS vÃ©rifier avant dÃ©ploiement
const ERC7730_CHECKLIST = {
  descriptorExists: true,      // Descripteur JSON existe
  fieldsComplete: true,        // Tous les champs sont mappÃ©s
  intentClear: true,          // L'intent est comprÃ©hensible
  testedOnLedger: true,       // TestÃ© sur device Ledger
  registrySubmitted: true     // Soumis au registre
};
```

### Messages d'Erreur Clairs
```typescript
// Messages d'erreur en franÃ§ais pour LeBonKoin
const CLEAR_SIGNING_ERRORS = {
  NO_DESCRIPTOR: "Impossible d'afficher les dÃ©tails de cette transaction",
  INVALID_FORMAT: "Format de transaction non reconnu",
  MISSING_FIELDS: "Informations manquantes pour la signature",
  LEDGER_UNSUPPORTED: "Cette transaction n'est pas supportÃ©e par votre Ledger"
};
```

## ðŸ“Š MÃ‰TRIQUES DE SUCCÃˆS

### KPIs ERC-7730
- âœ… 100% des transactions LeBonKoin ont un descripteur ERC-7730
- âœ… Taux de rÃ©ussite des signatures > 98%
- âœ… Temps d'affichage des dÃ©tails < 2 secondes
- âœ… 0 transaction "blind signed" sur LeBonKoin

### Tests Obligatoires
```typescript
// Tests unitaires pour chaque descripteur
describe('ERC-7730 Clear Signing', () => {
  it('should display payment details clearly', () => {
    // Test affichage paiement
  });
  
  it('should show release confirmation', () => {
    // Test confirmation libÃ©ration
  });
  
  it('should handle edge cases', () => {
    // Test cas limites
  });
});
```

## ðŸ”— RESSOURCES TECHNIQUES

- **Builder Ledger** : [https://get-clear-signed.ledger.com/](https://get-clear-signed.ledger.com/)
- **Documentation ERC-7730** : [https://developers.ledger.com/docs/clear-signing/understanding/what-is-it](https://developers.ledger.com/docs/clear-signing/understanding/what-is-it)
- **Standard ERC-7730** : RÃ©fÃ©rence officielle pour l'implÃ©mentation

---

**ðŸŽ¯ OBJECTIF FINAL** : Chaque utilisateur de LeBonKoin doit **toujours** savoir exactement ce qu'il signe, sans exception. La transparence totale est non nÃ©gociable.
